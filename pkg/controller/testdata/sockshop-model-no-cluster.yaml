# Copyright (C) 2020, Oracle and/or its affiliates.
# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.

apiVersion: verrazzano.io/v1beta1
kind: VerrazzanoModel
metadata:
  name: sock-shop-model
  namespace: default
spec:
  description: "Sock Shop Model"
  scope: Namespaced
  group: verrazzano.io
  helidonApplications:
    - name: "frontend"
      image: "helidonsockshop/front-end:0.3.12"
      port: 8088
      targetPort: 8079
      connections:
        - ingress:
            - name: "sockshop-frontend-ingress"
              port: 80
              match:
                - uri:
                    exact: /
                - uri:
                    exact: /cart
                - uri:
                    prefix: /cart
                - uri:
                    exact: /catalogue
                - uri:
                    exact: /login
                - uri:
                    prefix: /catalogue
                - uri:
                    prefix: /css
                - uri:
                    prefix: /js
                - uri:
                    prefix: /img
                - uri:
                    regex: ^.*\.(ico|png|jpg|html)$
    - name: "carts"
      image: "helidonsockshop/carts-core:latest"
    - name: "catalogue"
      image: "helidonsockshop/catalog-core:latest"
    - name: "orders"
      image: "helidonsockshop/orders-core:latest"
    - name: "payment"
      image: "helidonsockshop/payment-core:latest"
    - name: "shipping"
      image: "helidonsockshop/shipping-core:latest"
    - name: "user"
      image: "helidonsockshop/users-core:latest"
      port: 80
      targetPort: 7001
    - name: "swagger"
      image: "swaggerapi/swagger-ui:latest"
  weblogicDomains:
    - name: wl-frontend
      adminPort: 32701
      t3Port: 32702
      domainCRValues:
        domainUID: wl-frontend
        domainHome: /u01/oracle/user_projects/domains/wl-frontend
        image: container-registry.oracle.com/verrazzano/wl-frontend:324813
        logHome: /u01/oracle/user_projects/domains/wl-frontend/logs
        logHomeEnabled: false
        includeServerOutInPodLog: true
        replicas: 1
        webLogicCredentialsSecret:
          name: wl-frontend-weblogic-credentials
        imagePullSecrets:
          - name: ocir
        serverPod:
          env:
            - name: JAVA_OPTIONS
              value: "-Dweblogic.StdoutDebugEnabled=false"
            - name: USER_MEM_ARGS
              value: "-Djava.security.egd=file:/dev/./urandom -Xms64m -Xmx256m "
            - name: WL_HOME
              value: /u01/oracle/wlserver
            - name: MW_HOME
              value: /u01/oracle
      connections:
        - ingress:
            - name: wl-ingress
        - rest:
            - target: "catalogue"
              environmentVariableForHost: "HELIDON_HOSTNAME"
              environmentVariableForPort: "HELIDON_PORT"
        - database:
            - target: "mysql"
              datasourceName: "socks"
        - database:
            - target: "oracle"
              datasourceName: "socks2"

